<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Every Next Day</title>
  <style>
    /* keep your existing admin styles or paste from current file */
    body{font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;background:#f6f8fb;margin:0;padding:24px}
    .admin-container{max-width:1100px;margin:24px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid #e6eef8;padding:8px;text-align:left}
    th{background:#f0f7ff;color:#03396c}
    .admin-auth{text-align:center;margin-top:40px}
    .admin-auth input{padding:8px 10px;border-radius:6px;border:1px solid #ccc}
    .admin-auth button{padding:8px 12px;margin-left:8px;border-radius:6px;border:none;background:#0366d6;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="admin-container" id="adminPanel" style="display:none">
    <h2>Submitted Applications</h2>
    <div id="responsesTableContent"></div>
  </div>

  <div class="admin-auth" id="adminAuth">
    <form id="adminLoginForm" autocomplete="off">
      <label for="adminPass">Admin Code:</label>
      <input type="password" id="adminPass" required value="0000" />
      <button type="submit">View Responses</button>
    </form>
    <div id="adminAuthMsg" style="color:#c00;margin-top:10px;"></div>
    <div style="margin-top:18px"><a href="index.html">Back to Home</a></div>
  </div>

  <script>
    document.getElementById('adminLoginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const code = document.getElementById('adminPass').value.trim();
      const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzC63FCN9H_snRaGMrdEp20URyd_6eyWxumKAltU6mW7KrCUqzQOZpcJnGwjFTJolzaUQ/exec'; // Replace with your Apps Script URL

      const resp = await fetch(SCRIPT_URL + '?admin=' + encodeURIComponent(code));
      const j = await resp.json();
      if (!j.ok) {
        document.getElementById('adminAuthMsg').textContent = j.error || 'Unauthorized';
        return;
      }
      renderResponses(j.responses || []);
    });

    function renderResponses(list) {
      const container = document.getElementById('responsesTableContent');
      if (!list.length) {
        container.innerHTML = '<p style="color:#666">No responses yet.</p>';
        return;
      }
      let html = '<div style="overflow:auto"><table><thead><tr>';
      html += '<th>Name</th><th>WhatsApp</th><th>Email</th><th>Occupation</th><th>Skills</th><th>Why Join</th><th>Goals</th><th>Fee Consent</th><th>Submitted</th>';
      html += '</tr></thead><tbody>';
      list.forEach(r => {
        html += '<tr>';
        html += `<td>${escapeHtml(r.fullName)}</td>`;
        html += `<td>${escapeHtml(r.whatsapp)}</td>`;
        html += `<td>${escapeHtml(r.email)}</td>`;
        html += `<td>${escapeHtml(r.occupation)}</td>`;
        html += `<td>${escapeHtml(r.skills)}</td>`;
        html += `<td>${escapeHtml(r.whyJoin)}</td>`;
        html += `<td>${escapeHtml(r.goals)}</td>`;
        html += `<td>${escapeHtml(r.feeConsent)}</td>`;
        html += `<td>${new Date(r.submittedAt).toLocaleString()}</td>`;
        html += '</tr>';
      });
      html += '</tbody></table></div>';
      container.innerHTML = html;
    }

    function escapeHtml(s) {
      return String(s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
  </script>
</body>
</html>
